# 数字存储RAM模块

## 模块概述

`num_storage_ram` 是一个双端口RAM模块，用于存储转换后的32位有符号整数。该模块支持同时进行读写操作。

## 参数说明

| 参数名 | 默认值 | 说明 |
|--------|--------|------|
| DATA_WIDTH | 32 | 数据位宽 |
| DEPTH | 2048 | 存储深度 |
| ADDR_WIDTH | 11 | 地址位宽（$clog2(DEPTH)） |

## 接口定义

### 输入信号

| 信号名 | 位宽 | 说明 |
|--------|------|------|
| clk | 1 | 时钟信号 |
| rst_n | 1 | 异步低电平复位 |
| clear | 1 | 清空RAM信号（单周期脉冲） |
| wr_en | 1 | 写使能信号 |
| wr_addr | ADDR_WIDTH | 写地址 |
| wr_data | DATA_WIDTH | 写数据 |
| rd_addr | ADDR_WIDTH | 读地址 |

### 输出信号

| 信号名 | 位宽 | 说明 |
|--------|------|------|
| rd_data | DATA_WIDTH | 读数据输出 |

## 功能说明

### 清空操作（新增）
- 当 `clear` 信号为高电平时，模块进入清空状态
- 清空过程中，RAM的所有地址会被依次写入0
- 清空期间自动禁止正常写操作（clear优先级高于wr_en）
- 清空整个RAM（2048个地址）需要2048个时钟周期
- 清空完成后自动返回正常工作模式

**使用建议**：
- 在输入新矩阵数据前清空缓冲区，确保数据不足时剩余位置为0
- clear信号可以是单周期脉冲，模块内部会自动完成整个清空过程
- 清空期间避免读写操作

### 写操作
- 当 `wr_en` 为高电平时，在时钟上升沿将 `wr_data` 写入 `wr_addr` 指定的地址
- 写操作为同步写入
- **注意**：清空期间写使能会被忽略

### 读操作
- 读操作为同步读取，有一个时钟周期的延迟
- 复位时输出清零
- 清空期间仍可读取（可能读到部分已清零的数据）

## 时序特性

- **写延迟**：1个时钟周期（同步写入）
- **读延迟**：1个时钟周期（寄存器输出）
- **清空时间**：2048个时钟周期（完整清空所有地址）
- **读写冲突**：同时读写同一地址时，读出的是旧数据
- **清空优先级**：清空操作优先于正常写操作

## 使用示例

```systemverilog
// 清空RAM（新增功能）
@(posedge clk);
clear <= 1'b1;
@(posedge clk);
clear <= 1'b0;

// 等待清空完成（2048个周期）
repeat(2048) @(posedge clk);

// 写入数据
@(posedge clk);
wr_en <= 1'b1;
wr_addr <= 11'd0;
wr_data <= 32'd123;

@(posedge clk);
wr_en <= 1'b0;

// 读取数据
@(posedge clk);
rd_addr <= 11'd0;

@(posedge clk);  // 等待读延迟
@(posedge clk);
// 此时 rd_data 中包含读取的数据
```

## 资源占用

- **BRAM**: 1块 (2048×32 = 64Kbit)
- **逻辑资源**: 极少（仅地址和控制逻辑）

## 注意事项

1. **读延迟**：读操作有1个周期延迟，需要在读地址设置后等待一个时钟周期才能获取有效数据
2. **复位行为**：复位时仅清零输出寄存器，不清空内存内容
3. **清空功能**：通过 `clear` 信号清空RAM需要2048个时钟周期，建议在系统空闲时执行
4. **清空期间**：清空时自动禁止正常写操作，读操作仍可进行但可能读到部分已清零的数据
5. **读写冲突**：建议避免在同一时钟周期对同一地址进行读写操作
6. **地址范围**：确保地址在有效范围内（0到DEPTH-1），否则可能导致不可预测的行为
7. **按钮集成**：clear信号可直接连接到FPGA按钮，实现手动清空功能

## 测试验证

测试文件：`modules/ascii_num_sep/sim/num_storage_ram_tb.sv`

测试用例包括：
- 基本读写操作
- 顺序写入和读取
- 负数存储
- 地址覆盖
- 边界地址测试
- 大数值测试
- 并发读写
- **清空功能测试**（新增）
- **清空后写入测试**（新增）
