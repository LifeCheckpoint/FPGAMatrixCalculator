# ASCII到INT32转换器模块

## 模块概述

`ascii_to_int32` 模块将ASCII字符流转换为32位有符号整数。它接收一系列数字字符（0-9）和可选的负号（-），累积计算出对应的整数值。

## 接口定义

### 输入信号

| 信号名 | 位宽 | 说明 |
|--------|------|------|
| clk | 1 | 时钟信号 |
| rst_n | 1 | 异步低电平复位 |
| start | 1 | 开始新数字转换的脉冲信号 |
| char_in | 8 | 输入的ASCII字符 |
| char_valid | 1 | 字符有效信号 |
| num_end | 1 | 数字结束信号 |

### 输出信号

| 信号名 | 位宽 | 说明 |
|--------|------|------|
| result | 32 (signed) | 转换后的有符号整数结果 |
| result_valid | 1 | 结果有效信号（单周期脉冲） |

## 功能说明

### 状态机

模块内部使用三态状态机：

1. **IDLE**：空闲状态，等待start信号
2. **ACCUMULATE**：累积状态，接收字符并计算数值
3. **OUTPUT**：输出状态，产生result_valid并输出结果

### 转换逻辑

#### 数字累积算法
```
对于每个数字字符 '0'-'9':
  accumulator = accumulator × 10 + (char - 0x30)
```

#### 负号处理
- 负号（'-', 0x2D）只在数字开始时有效
- 设置内部标志 `is_negative`
- 在输出阶段对结果取负

### 字符编码

| 字符 | ASCII码 | 说明 |
|------|---------|------|
| '0'-'9' | 0x30-0x39 | 数字字符 |
| '-' | 0x2D | 负号 |

## 时序说明

### 典型转换序列

```
周期  start  char_in  char_valid  num_end  result_valid  result
--------------------------------------------------------------------
 1      1      -         0          0          0            -
 2      0     '1'        1          0          0            -
 3      0     '2'        1          0          0            -
 4      0     '3'        1          0          0            -
 5      0      -         0          1          0            -
 6      0      -         0          0          1           123
```

### 负数转换序列

```
周期  start  char_in  char_valid  num_end  result_valid  result
--------------------------------------------------------------------
 1      1      -         0          0          0            -
 2      0     '-'        1          0          0            -
 3      0     '4'        1          0          0            -
 4      0     '5'        1          0          0            -
 5      0      -         0          1          0            -
 6      0      -         0          0          1           -45
```

## 使用示例

### 转换正数 "123"

```systemverilog
// 开始转换
@(posedge clk);
start <= 1'b1;
@(posedge clk);
start <= 1'b0;

// 发送字符 '1'
char_in <= 8'h31;  // '1'
char_valid <= 1'b1;
@(posedge clk);
char_valid <= 1'b0;

// 发送字符 '2'
char_in <= 8'h32;  // '2'
char_valid <= 1'b1;
@(posedge clk);
char_valid <= 1'b0;

// 发送字符 '3'
char_in <= 8'h33;  // '3'
char_valid <= 1'b1;
@(posedge clk);
char_valid <= 1'b0;

// 结束信号
num_end <= 1'b1;
@(posedge clk);
num_end <= 1'b0;

// 等待结果
@(posedge clk);
while (!result_valid) @(posedge clk);
// result = 123
```

### 转换负数 "-456"

```systemverilog
start <= 1'b1;
@(posedge clk);
start <= 1'b0;

// 负号
char_in <= 8'h2D;  // '-'
char_valid <= 1'b1;
@(posedge clk);
char_valid <= 1'b0;

// 数字 4, 5, 6
// ... (类似上面)

num_end <= 1'b1;
@(posedge clk);
num_end <= 1'b0;

// result = -456
```

## 特殊情况处理

### 1. 只有负号的情况
- 输入："-" + num_end
- 输出：result = 0

### 2. 前导零
- 输入："007"
- 输出：result = 7
- 说明：前导零不影响结果

### 3. 最大/最小值
- 最大正数：2147483647 (0x7FFFFFFF)
- 最小负数：-2147483648 (0x80000000)
- **注意**：超出范围的数值会溢出，模块不进行溢出检测

## 性能特性

- **转换周期数**：N + 3个时钟周期
  - N：字符数量
  - 3：start、num_end、output各1个周期
- **吞吐率**：连续转换时，每个数字约需N + 3个周期
- **延迟**：从num_end到result_valid为1个时钟周期

## 资源占用

- **LUTs**：约50个（状态机 + 乘法器 + 加法器）
- **FFs**：约40个（累加器 + 状态寄存器）
- **DSP**：1个（用于×10乘法运算）

## 注意事项

1. **溢出**：模块不检测溢出，超过32位范围的数值会回绕
2. **负号位置**：负号必须是第一个字符，否则被视为数字一部分（实际会被忽略）
3. **无效字符**：接收到非数字、非负号字符时会被忽略
4. **连续转换**：必须等待result_valid后才能开始下一次转换
5. **字符顺序**：字符必须按正确顺序发送（高位到低位）

## 测试验证

测试文件：`modules/ascii_num_sep/sim/ascii_to_int32_tb.sv`

测试用例包括：
- 单个数字
- 多位正数
- 负数
- 大数值
- 前导零
- 零值
- 边界值（最大/最小int32）
- 连续转换